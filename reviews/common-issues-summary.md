# 共通指摘事項まとめ

## 全体的な傾向

### 高頻度で指摘されている共通問題

#### 1. エラーハンドリングの不備
**影響範囲:** 複数のファイル
- **Aura.cs**: Console.WriteLineによる限定的なログ出力、包括的な例外キャッチ
- **AppConfig.cs**: ファイルI/O処理の例外処理不足、null許可演算子の不適切な使用
- **LogWatcher.cs**: 継続的な失敗時の対策不足、一時的エラーと致命的エラーの区別なし

**統一推奨解決策:**
- 構造化ログの導入（ILogger使用）
- 具体的な例外タイプに対応した処理
- リトライ機構と指数バックオフの実装

#### 2. パフォーマンス問題
**影響範囲:** 複数のファイル
- **Aura.cs**: 毎回全JSONをデシリアライズ、LinearSearch（O(n)）による検索
- **LogWatcher.cs**: ポーリング方式による不要なリソース消費
- **AppConfig.cs**: ファイル存在チェックの頻繁な呼び出し

**統一推奨解決策:**
- キャッシュ機構の実装
- イベントドリブン方式の採用
- 非同期I/Oの活用

#### 3. セキュリティ考慮事項
**影響範囲:** 複数のファイル
- **AppConfig.cs**: Discord Webhook URLが平文で保存、パストラバーサル攻撃対策不足
- **LogWatcher.cs**: ログインジェクションのリスク、リソース枯渇攻撃への対策不足

**統一推奨解決策:**
- 機密情報の暗号化または適切な権限設定
- 入力値検証の強化
- ファイルパス正規化とセキュリティチェック

#### 4. テスト容易性の問題
**影響範囲:** 複数のファイル
- **AppConfig.cs**: 静的クラスのためモックが困難
- **LogWatcher.cs**: ファイルシステムへの依存が強い
- **Aura.cs**: JSONData依存による強い結合

**統一推奨解決策:**
- 依存性注入の導入
- インターフェースによる抽象化
- ファクトリーパターンの採用

## プロジェクト全体の技術的負債

### 設計パターンの一貫性
- **現状**: 一部でシングルトンパターン、一部で静的クラス
- **推奨**: 設計パターンの統一とドキュメント化

### ライブラリの混在
- **問題**: JSONライブラリの混在（Newtonsoft.Json vs System.Text.Json）
- **推奨**: プロジェクト全体での統一

### ログ出力の一貫性
- **問題**: Console.WriteLineとstructured loggingの混在
- **推奨**: ILoggerインターフェースによる統一

## 相互関連性のあるファイル

### 設定管理グループ
- **AppConfig.cs** ⟷ **ConfigData.cs**
- 共通課題: JSONライブラリの統一、スレッドセーフティ

### データアクセスグループ  
- **Aura.cs** ⟷ **JsonData.cs**
- 共通課題: パフォーマンス最適化、キャッシュ機構

### VRChat連携グループ
- **LogWatcher.cs** ⟷ **AuthenticatedDetectionService.cs**
- 共通課題: エラー復旧機構、リソース管理

## 改善優先度マトリックス

### 緊急（影響大・実装容易）
1. JSONライブラリの統一
2. Console.WriteLineからILoggerへの移行
3. 基本的な例外処理の追加

### 高優先度（影響大・実装中程度）
1. キャッシュ機構の実装（Aura.cs）
2. FileSystemWatcherの導入（LogWatcher.cs）
3. スレッドセーフティの確保（AppConfig.cs）

### 中優先度（影響中・実装中程度）
1. 依存性注入の導入
2. セキュリティ強化
3. リトライ機構の実装

### 低優先度（影響小・実装困難）
1. 完全な抽象化とインターフェース分離
2. 包括的な監視機能
3. 高度なパフォーマンス最適化